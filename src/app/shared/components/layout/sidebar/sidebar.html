<div class="sidebar-container" [class.collapsed]="collapsed">
      
      <!-- LOGO -->
      <div class="logo-area">
        <div class="logo-box">
          <span class="material-icons logo-icon">business_center</span>
        </div>
        <div class="app-name">
          <span class="font-bold text-gray-800">HR</span> Portal
        </div>
      </div>

      <!-- NAVEGACIÓN -->
      <nav class="menu-nav">
        
        <ng-container *ngFor="let item of menuItems">
          
          <!-- CASO 1: ITEM SIMPLE (Sin Hijos) -->
          <ng-container *ngIf="!item.children && hasPermission(item.roles)">
            <a [routerLink]="item.route"
               routerLinkActive="active-link"
               class="menu-item"
               matRipple
               [matTooltip]="collapsed ? item.label : ''"
               matTooltipPosition="right">
              <mat-icon class="menu-icon">{{ item.icon }}</mat-icon>
              <span class="menu-label">{{ item.label }}</span>
              <div class="active-indicator"></div>
            </a>
          </ng-container>

          <!-- CASO 2: GRUPO (Con Hijos) -->
          <ng-container *ngIf="item.children && hasGroupPermission(item)">
            
            <!-- Cabecera del Grupo -->
            <div class="menu-group-header" 
                 [matMenuTriggerFor]="collapsed ? childMenu : null"
                 (click)="collapsed ? null : toggleGroup(item)"
                 [class.group-active]="item.isOpen && !collapsed"
                 matRipple
                 [matTooltip]="collapsed ? item.label : ''"
                 matTooltipPosition="right">
              
              <mat-icon class="menu-icon">{{ item.icon }}</mat-icon>
              <span class="menu-label">{{ item.label }}</span>
              
              <!-- Flecha de expansión -->
              <mat-icon class="chevron-icon" *ngIf="!collapsed">expand_more</mat-icon>
            </div>

            <!-- SUBMENÚ FLOTANTE (Solo para Modo Colapsado) -->
            <mat-menu #childMenu="matMenu" xPosition="after" class="sidebar-popup-menu">
              <ng-container *ngFor="let child of item.children">
                <a mat-menu-item 
                   *ngIf="hasPermission(child.roles)"
                   [routerLink]="child.route"
                   routerLinkActive="active-menu-item">
                   <!-- Icono opcional en submenú si quisieras -->
                   <mat-icon *ngIf="child.icon" class="popup-icon">{{child.icon}}</mat-icon>
                   <span>{{ child.label }}</span>
                </a>
              </ng-container>
            </mat-menu>

            <!-- LISTA ACORDEÓN (Solo para Modo Expandido) -->
            <div class="submenu-container" 
                 [class.submenu-open]="item.isOpen && !collapsed">
              
              <ng-container *ngFor="let child of item.children">
                <a *ngIf="hasPermission(child.roles)"
                   [routerLink]="child.route"
                   routerLinkActive="active-sublink"
                   class="submenu-item"
                   matRipple>
                   <!-- Diseño Limpio: Sin Bullet, solo texto con indentación -->
                   {{ child.label }}
                </a>
              </ng-container>

            </div>

          </ng-container>

        </ng-container>
      </nav>

      <!-- PERFIL MINI -->
      <div class="user-mini-profile">
        <div class="avatar-circle">{{ userInitials }}</div>
        <div class="user-info">
          <p class="name">{{ userName }}</p>
          <p class="role">{{ userRole }}</p>
        </div>
      </div>

    </div>