<aside class="sidebar" [class.collapsed]="collapsed()">
  
  <div class="sidebar-header">
    <div class="logo-box">
      <img src="images/logo-icon.svg" alt="Emplix" class="logo-icon">
    </div>
    <span class="logo-text fade-in">Emplix</span>
  </div>

  <div class="sidebar-content custom-scroll">
    <nav class="nav-list">
      
      @for (item of menuItems(); track item.label) {
        @if (hasGroupPermission(item)) {

          @if (item.children) {
            
            <div class="nav-group">
              <div class="nav-item group-header" 
                   [class.open]="item.isOpen && !collapsed()"
                   (click)="!collapsed() && toggleGroup(item)" 
                   [matMenuTriggerFor]="collapsed() ? submenu : null" 
                   [matTooltip]="collapsed() ? item.label : ''"
                   matTooltipPosition="right">
                
                <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
                <span class="nav-label fade-in">{{ item.label }}</span>
                <mat-icon class="chevron">expand_more</mat-icon>
              </div>

              @if (item.isOpen && !collapsed()) {
                <div class="group-children expand-animation">
                  @for (subItem of item.children; track subItem.label) {
                    @if (hasPermission(subItem.roles)) {
                      <a [routerLink]="subItem.route" 
                         routerLinkActive="active" 
                         class="child-item">
                         {{ subItem.label }}
                      </a>
                    }
                  }
                </div>
              }

              <mat-menu #submenu="matMenu" class="sidebar-popup-menu" xPosition="after">
                @for (subItem of item.children; track subItem.label) {
                  @if (hasPermission(subItem.roles)) {
                    <a mat-menu-item 
                       [routerLink]="subItem.route" 
                       routerLinkActive="active-sublink">
                      <mat-icon>{{ subItem.icon || 'radio_button_unchecked' }}</mat-icon>
                      <span>{{ subItem.label }}</span>
                    </a>
                  }
                }
              </mat-menu>
            </div>
          
          } @else {
            <a [routerLink]="item.route" 
               routerLinkActive="active" 
               [routerLinkActiveOptions]="{exact: true}"
               class="nav-item"
               [matTooltip]="collapsed() ? item.label : ''"
               matTooltipPosition="right">
              <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
              <span class="nav-label fade-in">{{ item.label }}</span>
            </a>
          }

        }
      }
    </nav>
  </div>

  <div class="sidebar-footer">
    <div class="user-card">
      <div class="avatar">{{ userInitials }}</div>
      <div class="user-info fade-in">
        <span class="name">{{ userName() }}</span>
        <span class="role">{{ userRole() }}</span>
      </div>
    </div>
  </div>

</aside>