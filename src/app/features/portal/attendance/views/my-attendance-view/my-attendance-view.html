<div class="view-container animate-fade-in">
  <div class="content-wrapper">

    <header class="page-header-custom">
      <div class="header-text">
        <h1>Mi Asistencia</h1>
        <p>Historial de marcaciones y horas trabajadas.</p>
      </div>
      
      <div class="month-selector">
        <button mat-icon-button (click)="changeMonth(-1)"><mat-icon>chevron_left</mat-icon></button>
        <span class="current-month">{{ currentMonthName }} {{ currentYear }}</span>
        <button mat-icon-button (click)="changeMonth(1)"><mat-icon>chevron_right</mat-icon></button>
      </div>
    </header>

    <div class="stats-overview mb-8">
      
      <div class="stat-box">
        <div class="circular-chart" [style.--percent]="stats().punctuality">
          <svg viewBox="0 0 36 36">
            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            <path class="circle" stroke-dasharray="85, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
          </svg>
          <div class="percentage">{{ stats().punctuality }}%</div>
        </div>
        <span class="label">Puntualidad</span>
      </div>

      <div class="divider"></div>

      <div class="stat-item orange">
        <span class="value">{{ stats().lates }}</span>
        <span class="label">Tardanzas</span>
      </div>

      <div class="divider"></div>

      <div class="stat-item blue">
        <span class="value">{{ stats().totalHours }}h</span>
        <span class="label">Horas Trabajadas</span>
      </div>

    </div>

    <div class="timeline-container">
      
      <div class="timeline-item" *ngFor="let log of attendanceLogs()">
        
        <div class="date-col">
          <span class="day-number">{{ log.date | date:'dd' }}</span>
          <span class="day-name">{{ log.date | date:'EEE' | uppercase }}</span>
        </div>

        <div class="log-card">
          
          <div class="time-track">
            <div class="track-bar">
              <div class="worked-bar" [style.width]="(log.hoursWorked / 9 * 100) + '%'"></div>
            </div>
            <div class="times">
              <span class="time start">
                <mat-icon>login</mat-icon> {{ log.checkIn | date:'shortTime' }}
              </span>
              <span class="time end" *ngIf="log.checkOut">
                {{ log.checkOut | date:'shortTime' }} <mat-icon>logout</mat-icon>
              </span>
              <span class="time ongoing" *ngIf="!log.checkOut">
                En turno... <div class="pulse-dot"></div>
              </span>
            </div>
          </div>

          <div class="status-col">
            <span class="status-badge" [ngClass]="log.status">
              {{ log.status }}
            </span>
            <span class="hours-badge" *ngIf="log.hoursWorked > 0">
              {{ log.hoursWorked }} hrs
            </span>
          </div>

        </div>
      </div>

      <div *ngIf="attendanceLogs().length === 0" class="empty-state">
        <mat-icon>calendar_today</mat-icon>
        <p>No hay registros para este mes.</p>
      </div>

    </div>

  </div>
</div>