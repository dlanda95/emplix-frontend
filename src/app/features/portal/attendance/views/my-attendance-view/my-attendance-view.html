<app-content-layout-view 
  title="Mi Asistencia" 
  subtitle="Historial de marcaciones y horas trabajadas.">

  <div actions>
    <div class="month-selector">
      <button mat-icon-button (click)="changeMonth(-1)">
        <mat-icon>chevron_left</mat-icon>
      </button>
      
      <span class="current-month">
        {{ currentMonthName }} {{ currentYear }}
      </span>
      
      <button mat-icon-button (click)="changeMonth(1)">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  </div>

  <div class="animate-fade-in flex-column-gap">
    
    <div class="stats-overview">
      
      <div class="stat-box">
        <div class="circular-chart">
          <svg viewBox="0 0 36 36">
            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            <path class="circle" 
                  [attr.stroke-dasharray]="stats().punctuality + ', 100'" 
                  d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
          </svg>
          <div class="percentage">{{ stats().punctuality }}%</div>
        </div>
        <span class="label">Puntualidad</span>
      </div>

      <div class="divider"></div>

      <div class="stat-item orange">
        <span class="value">{{ stats().lates }}</span>
        <span class="label">Tardanzas</span>
      </div>

      <div class="divider"></div>

      <div class="stat-item blue">
        <span class="value">{{ stats().totalHours }}h</span>
        <span class="label">Horas Trabajadas</span>
      </div>

    </div>

    <div class="timeline-container">
      
      @if (attendanceLogs().length > 0) {
        
        @for (log of attendanceLogs(); track log) { <div class="timeline-item">
            
            <div class="date-col">
              <span class="day-number">{{ log.date | date:'dd' }}</span>
              <span class="day-name">{{ log.date | date:'EEE' | uppercase }}</span>
            </div>

            <div class="log-card">
              
              <div class="time-track">
                <div class="track-bar">
                  <div class="worked-bar" [style.width]="(log.hoursWorked / 9 * 100) + '%'"></div>
                </div>
                <div class="times">
                  <span class="time start">
                    <mat-icon>login</mat-icon> {{ log.checkIn | date:'shortTime' }}
                  </span>
                  
                  @if (log.checkOut) {
                    <span class="time end">
                      {{ log.checkOut | date:'shortTime' }} <mat-icon>logout</mat-icon>
                    </span>
                  } @else {
                    <span class="time ongoing">
                      En turno... <div class="pulse-dot"></div>
                    </span>
                  }
                </div>
              </div>

              <div class="status-col">
                <span class="status-badge" [ngClass]="log.status">
                  {{ log.status }}
                </span>
                
                @if (log.hoursWorked > 0) {
                  <span class="hours-badge">
                    {{ log.hoursWorked }} hrs
                  </span>
                }
              </div>

            </div>
          </div>
        }

      } @else {
        <div class="empty-state">
          <mat-icon>calendar_today</mat-icon>
          <p>No hay registros para este mes.</p>
        </div>
      }

    </div>

  </div>

</app-content-layout-view>