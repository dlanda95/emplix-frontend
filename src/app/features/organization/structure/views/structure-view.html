<app-content-layout-view

  title="Estructura Organizacional" 
  subtitle="Define las áreas, jerarquías y puestos de trabajo.">

  <div actions>
    <button mat-flat-button color="primary" (click)="openDepartmentDialog()">
      <mat-icon>add</mat-icon> Nueva Área
    </button>
  </div>

  @if (loading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <span>Cargando estructura...</span>
    </div>

  } @else {
    
    @if (departments.length > 0) {
      <div class="org-grid animate-fade-in">
        
        @for (dept of departments; track dept.id) { <div class="org-card">
            
            <div class="card-header">
              <div class="dept-info">
                <div class="dept-icon">
                  <mat-icon>business</mat-icon>
                </div>
                <div class="dept-text">
                  <h3>{{ dept.name }}</h3>
                  <span class="dept-code">{{ dept.code || 'S/C' }}</span>
                </div>
              </div>

              <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="openDepartmentDialog(dept)">
                  <mat-icon>edit</mat-icon> Editar Área
                </button>
                <button mat-menu-item (click)="deleteDepartment(dept)">
                  <mat-icon color="warn">delete</mat-icon> <span class="text-warn">Eliminar Área</span>
                </button>
              </mat-menu>
            </div>

            <div class="card-stats">
              <div class="stat-item" matTooltip="Empleados Activos">
                <mat-icon>group</mat-icon>
                <span>{{ dept._count?.employees || 0 }}</span>
              </div>
              <div class="stat-item" matTooltip="Cargos Definidos">
                <mat-icon>badge</mat-icon>
                <span>{{ dept._count?.positions || 0 }}</span>
              </div>
            </div>

            <div class="card-body">
              <p class="section-label">Cargos Principales</p>
              
              @if (dept.positions && dept.positions.length > 0) {
                <div class="positions-list">
                  @for (pos of dept.positions.slice(0, 3); track pos.id) {
                    <div class="position-item">
                      <span class="dot"></span>
                      <span class="pos-name">{{ pos.name }}</span>
                    </div>
                  }
                  
                  @if (dept.positions.length > 3) {
                    <div class="more-positions">
                      + {{ dept.positions.length - 3 }} cargos más...
                    </div>
                  }
                </div>
              } @else {
                <div class="empty-positions">No hay cargos definidos aún.</div>
              }
            </div>

            <div class="card-actions">
              <button mat-stroked-button color="primary" class="full-width-btn" (click)="openPositionsDialog(dept)">
                Gestionar Cargos
              </button>
            </div>

          </div>
        }
      </div>
    } @else {
      
     <app-empty-state
    icon="domain_disabled"
    title="Estructura Vacía"
    description="No hay departamentos definidos aún.">
    
    <button mat-flat-button color="primary" (click)="openDepartmentDialog()">
      Crear primera Área
    </button>
    
  </app-empty-state>
    }
  }

</app-content-layout-view>